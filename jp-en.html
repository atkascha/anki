<html lang="en" xml:lang="en" xmlns= "http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="UTF-8">
    <meta name="google" content="notranslate">
    <meta http-equiv="Content-Language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Simple JP/EN flashcards</title>
    <link rel="stylesheet" href="./style.css">
  </head>
  <body>

    <div id="app">
      <div id="start">
        <h3>JP to EN</h3>
        <input name="alphabet" type="radio" value="hiragana" disabled>
        <label onclick="alert('Hiragana coming soon! ^__^')">hiragana</label>
        <input name="alphabet" type="radio" value="katakana" checked>
        <label>katakana</label>
        <!-- hacky way to space but whatever... -->
        <br />
        <br />
        <button id="button">start</button>
        <br />
        <br />
        <a target="new" href="https://www.nhk.or.jp/lesson/en/letters/katakana.html">katakana chart</a>
        <br />
        <a target="new" href="https://www.nhk.or.jp/lesson/en/letters/hiragana.html">hiragana chart</a>
      </div>

      <div id="content">
        <div id="jp"></div>
        <div id="options"></div>
        <div id="note"></div>
        <button id="next">next</button>
        <div id="score"></div>
      </div>
    </div>

  </body>

  <script>

    const ALPHABETS = {
      'katakana': {
        'ã‚¢': 'a',
        'ã‚¤': 'i',
        'ã‚¦': 'u',
        'ã‚¨': 'e',
        'ã‚ª': 'o',
        'ã‚«': 'ka',
        'ã‚­': 'ki',
        'ã‚¯': 'ku',
        'ã‚±': 'ke',
        'ã‚³': 'ko',
        'ã‚¬': 'ga',
        'ã‚®': 'gi',
        'ã‚°': 'gu',
        'ã‚²': 'ge',
        'ã‚´': 'go',
        'ã‚µ': 'sa',
        'ã‚·': 'shi',
        'ã‚¹': 'su',
        'ã‚»': 'se',
        'ã‚½': 'so',
        'ã‚¶': 'za',
        'ã‚¸': 'zi/ji',
        'ã‚º': 'zu',
        'ã‚¼': 'ze',
        'ã‚¾': 'zo',
        'ã‚¿': 'ta',
        'ãƒ': 'ti/chi',
        'ãƒ„': 'tsu/tu',
        'ãƒ†': 'te',
        'ãƒˆ': 'to',
        'ãƒ€': 'da',
        'ãƒ‚': 'di/ji',
        'ãƒ…': 'du/zu',
        'ãƒ‡': 'de',
        'ãƒ‰': 'do',
        'ãƒŠ': 'na',
        'ãƒ‹': 'ni',
        'ãƒŒ': 'nu',
        'ãƒ': 'ne',
        'ãƒ': 'no',
        'ãƒ': 'ha',
        'ãƒ’': 'hi',
        'ãƒ•': 'fu',
        'ãƒ˜': 'he',
        'ãƒ›': 'ho',
        'ãƒ': 'ba',
        'ãƒ“': 'bi',
        'ãƒ–': 'bu',
        'ãƒ™': 'be',
        'ãƒœ': 'bo',
        'ãƒ‘': 'pa',
        'ãƒ”': 'pi',
        'ãƒ—': 'pu',
        'ãƒš': 'pe',
        'ãƒ': 'po',
        'ãƒ': 'ma',
        'ãƒŸ': 'mi',
        'ãƒ ': 'mu',
        'ãƒ¡': 'me',
        'ãƒ¢': 'mo',
        'ã‚­ãƒ£': 'kya',
        'ã‚­ãƒ¥': 'kyu',
        'ã‚­ãƒ§': 'kyo',
        'ã‚·ãƒ£': 'sha',
        'ã‚·ãƒ¥': 'shu',
        'ã‚·ãƒ§': 'sho',
        'ãƒãƒ£': 'cha',
        'ãƒãƒ¥': 'chu',
        'ãƒãƒ§': 'cho',
        'ãƒ‹ãƒ£': 'nya',
        'ãƒ‹ãƒ¥': 'nyu',
        'ãƒ‹ãƒ§': 'nyo',
        'ãƒ’ãƒ£': 'hya',
        'ãƒ’ãƒ¥': 'hyu',
        'ãƒ’ãƒ§': 'hyo',
        'ãƒŸãƒ£': 'mya',
        'ãƒŸãƒ¥': 'myu',
        'ãƒŸãƒ§': 'myo',
        'ãƒªãƒ£': 'rya',
        'ãƒªãƒ¥': 'ryu',
        'ãƒªãƒ§': 'ryo',
        'ã‚®ãƒ£': 'gya',
        'ã‚®ãƒ¥': 'gyu',
        'ã‚®ãƒ§': 'gyo',
        'ã‚¸ãƒ£': 'ja',
        'ã‚¸ãƒ¥': 'ju',
        'ã‚¸ãƒ§': 'jo',
        'ãƒ“ãƒ£': 'bya',
        'ãƒ“ãƒ¥': 'byu',
        'ãƒ“ãƒ§': 'byo',
        'ãƒ”ãƒ£': 'pya',
        'ãƒ”ãƒ¥': 'pyu',
        'ãƒ”ãƒ§': 'pyo',
        'ãƒ¤': 'ya',
        'ãƒ¦': 'yu',
        'ãƒ¨': 'yo',
        'ãƒ©': 'ra',
        'ãƒª': 'ri',
        'ãƒ«': 'ru',
        'ãƒ¬': 're',
        'ãƒ­': 'ro',
        'ãƒ¯': 'wa',
        'ãƒ³': 'n',
      },
      'hiragana': {
      }
    }

    const INTERVAL = 400;

    class Option {
      constructor({ text }) {
        this.text = text;
      }

      get div() {
        let div = document.createElement('div');
        div.className = 'option';
        div.innerHTML = this.text;
        return div;
      }
    }

    class App {
      constructor() {
        this.selectedAlphabet = null;
        this.wrongAnswerEmoji = ['ğŸ¤¬','ğŸ¥¶', 'ğŸ˜¡', 'ğŸ¤¡', 'ğŸ’©', 'ğŸ¤¢', 'ğŸ’€', 'ğŸ‘½', 'ğŸ”’'];
        this.correctAnswerEmoji = ['ğŸ˜€', 'ğŸ˜', 'ğŸ¥³', 'ğŸ¤©', 'ğŸ˜Š', 'ğŸ¤—', 'ğŸ˜', 'ğŸ˜', 'ğŸ˜¸', 'ğŸ£', 'ãŠ—ï¸'];
        this.alphabets = document.querySelectorAll('input[name="alphabet"]');
        this.jpDiv = document.querySelector('#jp');
        this.startDiv = document.querySelector('#start');
        this.startButton = document.querySelector('#start #button');
        this.contentDiv = document.querySelector('#content');
        this.optionsDiv = document.querySelector('#options');
        this.noteDiv = document.querySelector('#note');
        this.scoreDiv = document.querySelector('#score');
        this.score = 0;

        this.#init();
      }

      get randomWrongEmoji() {
        return this.#getRandomElement(this.wrongAnswerEmoji);
      }

      get randomCorrectEmoji() {
        return this.#getRandomElement(this.correctAnswerEmoji);
      }

      get currentAlphabet() {
        return ALPHABETS[this.selectedAlphabet];
      }

      correctAnswer() {
        this.noteDiv.innerHTML = this.randomCorrectEmoji;
        this.score++;

        this.scoreDiv.innerText = `ğŸ”¥ ${this.score}`

        setTimeout(function() {
          this.prompt();
        }.bind(this), INTERVAL)
      }

      incorrectAnswer() {
        this.noteDiv.innerHTML = this.randomWrongEmoji;
        this.score = 0;
        this.scoreDiv.innerText = '';
      }

      prompt() {
        this.#clear();

        let keys = Object.keys(this.currentAlphabet);
        this.character = this.#getRandomElement(keys);
        this.jpDiv.innerHTML = this.character;
        this.answer = this.currentAlphabet[this.character];

        let options = this.#shuffle(this.#buildOptions(this.answer));

        for (let i = 0; i < options.length; i++) {
          let o = options[i];
          this.optionsDiv.appendChild(o);
          o.addEventListener('click', function(e) {
            if (this.answer === e.target.innerHTML) {
              this.correctAnswer();
            } else {
              this.incorrectAnswer();
            }
          }.bind(this));
        }
      }

      #init() {
        this.startButton.addEventListener('click', function(_e) {
          for (let i = 0; i < this.alphabets.length; i++) {
            if (this.alphabets[i].checked) {
              this.selectedAlphabet = this.alphabets[i].value;
            }
          }

          this.startDiv.style.display = 'none';
          this.contentDiv.style.display = 'block';
          this.prompt();
        }.bind(this));
      }

      #getRandomElement(items) {
        return items[Math.floor(Math.random() * items.length)];
      }

      #fetchCharacter(array) {
        let char = this.#getRandomElement(Object.values(this.currentAlphabet));
        if (array.includes(char)) {
          return this.#fetchCharacter(array)
        } else {
          return char;
        }
      }

      #buildOptions(answer) {
        let answers = [answer];
        for (let i = 0; i < 3; i++) {
          let char = this.#fetchCharacter(answers);
          answers.push(char);
        }

        let options = answers.map(a => new Option({ text: a }).div);

        return options;
      }

      // https://stackoverflow.com/a/2450976/20299436
      #shuffle(array) {
        let currentIndex = array.length, randomIndex;

        // While there remain elements to shuffle.
        while (currentIndex != 0) {

          // Pick a remaining element.
          randomIndex = Math.floor(Math.random() * currentIndex);
          currentIndex--;

          // And swap it with the current element.
          [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }

        return array;
      }

      #clear() {
        this.optionsDiv.innerHTML = '';
        this.noteDiv.innerHTML = '';
      }
    }

    const app = new App();

  </script>

</html>
